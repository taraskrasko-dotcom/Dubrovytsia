<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Google Sheets</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2C5F3D;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #2C5F3D;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1E4129;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ Google Sheets</h1>
        
        <div class="test-section">
            <h3>–ö—Ä–æ–∫ 1: –í–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É –≤–∞—à–æ–≥–æ Google Script</h3>
            <input type="text" id="scriptUrl" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec">
            <button onclick="saveUrl()">–ó–±–µ—Ä–µ–≥—Ç–∏ –∞–¥—Ä–µ—Å—É</button>
        </div>

        <div class="test-section">
            <h3>–ö—Ä–æ–∫ 2: –¢–µ—Å—Ç —á–∏—Ç–∞–Ω–Ω—è –∑ Google Sheets</h3>
            <button onclick="testRead()">–¢–µ—Å—Ç —á–∏—Ç–∞–Ω–Ω—è (GET)</button>
            <div id="readResult"></div>
        </div>

        <div class="test-section">
            <h3>–ö—Ä–æ–∫ 3: –¢–µ—Å—Ç –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ñ–æ—Ç–æ</h3>
            <input type="text" id="testImageUrl" placeholder="https://i.imgur.com/example.jpg">
            <input type="text" id="testTitle" placeholder="–¢–µ—Å—Ç–æ–≤–∞ –Ω–∞–∑–≤–∞">
            <select id="testPeriod">
                <option value="before-1900">–î–æ 1900</option>
                <option value="1900-1945">1900-1945</option>
                <option value="after-1945">–ü—ñ—Å–ª—è 1945</option>
            </select>
            <button onclick="testWrite()">–¢–µ—Å—Ç –¥–æ–¥–∞–≤–∞–Ω–Ω—è (POST)</button>
            <div id="writeResult"></div>
        </div>

        <div class="test-section">
            <h3>–ö—Ä–æ–∫ 4: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ CORS</h3>
            <button onclick="checkCORS()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ CORS</button>
            <div id="corsResult"></div>
        </div>

        <div class="test-section">
            <h3>üìù –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è —è–∫—â–æ —î –ø–æ–º–∏–ª–∫–∏:</h3>
            <div class="info">
<strong>1. –Ø–∫—â–æ –±–∞—á–∏—Ç–µ "CORS error" –∞–±–æ "mode: 'no-cors'":</strong>
   - –í–∞—à Google Script –º–∞—î –±—É—Ç–∏ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –≤ Apps Script –≤–∏ –≤–∏–±—Ä–∞–ª–∏ "–£—Å—ñ" –≤ –ø–æ–ª—ñ "–•—Ç–æ –º–∞—î –¥–æ—Å—Ç—É–ø"
   
<strong>2. –Ø–∫—â–æ –±–∞—á–∏—Ç–µ "404 Not Found":</strong>
   - –ê–¥—Ä–µ—Å–∞ —Å–∫—Ä–∏–ø—Ç–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞
   - –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ –≤–∏ —Å–∫–æ–ø—ñ—é–≤–∞–ª–∏ –ü–û–í–ù–£ –∞–¥—Ä–µ—Å—É –∑ Apps Script
   
<strong>3. –Ø–∫—â–æ –±–∞—á–∏—Ç–µ "Unauthorized":</strong>
   - –°–∫—Ä–∏–ø—Ç –Ω–µ –º–∞—î –¥–æ–∑–≤–æ–ª—É –Ω–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
   - –í–∏–¥–∞–ª—ñ—Ç—å —Å—Ç–∞—Ä–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ —Å—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–µ
   
<strong>4. –Ø–∫—â–æ —Ç–µ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç—å, –∞–ª–µ –Ω–∞ —Å–∞–π—Ç—ñ –Ω–µ –ø—Ä–∞—Ü—é—î:</strong>
   - –û—á–∏—Å—Ç—ñ—Ç—å –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Delete)
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ –≤ script.js
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)
            </div>
        </div>
    </div>

    <script>
        let GOOGLE_SCRIPT_URL = '';

        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—É –∞–¥—Ä–µ—Å—É
        window.onload = function() {
            const saved = localStorage.getItem('googleScriptUrl');
            if (saved) {
                document.getElementById('scriptUrl').value = saved;
                GOOGLE_SCRIPT_URL = saved;
            }
        };

        function saveUrl() {
            const url = document.getElementById('scriptUrl').value.trim();
            if (!url) {
                alert('–í–≤–µ–¥—ñ—Ç—å –∞–¥—Ä–µ—Å—É!');
                return;
            }
            GOOGLE_SCRIPT_URL = url;
            localStorage.setItem('googleScriptUrl', url);
            showResult('readResult', 'success', '‚úÖ –ê–¥—Ä–µ—Å—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
        }

        async function testRead() {
            if (!GOOGLE_SCRIPT_URL) {
                showResult('readResult', 'error', '‚ùå –°–ø–æ—á–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂—ñ—Ç—å –∞–¥—Ä–µ—Å—É!');
                return;
            }

            showResult('readResult', 'info', '‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –¥–∞–Ω—ñ...');

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL + '?action=getPhotos', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers]);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('Response data:', data);

                if (data.status === 'success') {
                    showResult('readResult', 'success', 
                        `‚úÖ –£–°–ü–Ü–•! –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${data.photos?.length || 0} —Ñ–æ—Ç–æ:\n\n` + 
                        JSON.stringify(data, null, 2)
                    );
                } else {
                    showResult('readResult', 'error', 
                        `‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ –¥–∞–Ω–∏—Ö:\n\n` + 
                        JSON.stringify(data, null, 2)
                    );
                }

            } catch (error) {
                console.error('Error:', error);
                showResult('readResult', 'error', 
                    `‚ùå –ü–û–ú–ò–õ–ö–ê:\n\n` +
                    `–¢–∏–ø: ${error.name}\n` +
                    `–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: ${error.message}\n\n` +
                    `–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:\n` +
                    `- CORS –ø–æ–º–∏–ª–∫–∞ (—Å–∫—Ä–∏–ø—Ç –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –¥–ª—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É)\n` +
                    `- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –∞–¥—Ä–µ—Å–∞ —Å–∫—Ä–∏–ø—Ç–∞\n` +
                    `- –ù–µ–º–∞—î —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –∑'—î–¥–Ω–∞–Ω–Ω—è`
                );
            }
        }

        async function testWrite() {
            if (!GOOGLE_SCRIPT_URL) {
                showResult('writeResult', 'error', '‚ùå –°–ø–æ—á–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂—ñ—Ç—å –∞–¥—Ä–µ—Å—É!');
                return;
            }

            const imageUrl = document.getElementById('testImageUrl').value;
            const title = document.getElementById('testTitle').value;
            const period = document.getElementById('testPeriod').value;

            if (!imageUrl || !title) {
                showResult('writeResult', 'error', '‚ùå –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!');
                return;
            }

            showResult('writeResult', 'info', '‚è≥ –î–æ–¥–∞—é —Ñ–æ—Ç–æ...');

            try {
                const requestData = {
                    action: 'addPhoto',
                    imageUrl: imageUrl,
                    title: title,
                    period: period,
                    date: new Date().toLocaleDateString('uk-UA')
                };

                console.log('Sending data:', requestData);

                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                console.log('Response status:', response.status);

                // –ó mode: 'no-cors' –º–∏ –Ω–µ –º–æ–∂–µ–º–æ —á–∏—Ç–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å, 
                // –∞–ª–µ —è–∫—â–æ –∑–∞–ø–∏—Ç –Ω–µ –≤–ø–∞–≤ - —Ü–µ –¥–æ–±—Ä–µ
                if (response.type === 'opaque' || response.ok) {
                    showResult('writeResult', 'success', 
                        `‚úÖ –£–°–ü–Ü–•! –§–æ—Ç–æ –¥–æ–¥–∞–Ω–æ.\n\n` +
                        `–¢–µ–ø–µ—Ä –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ Google –¢–∞–±–ª–∏—Ü—é - —Ç–∞–º –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—å –Ω–æ–≤–∏–π —Ä—è–¥–æ–∫.\n\n` +
                        `–Ø–∫—â–æ —Ä—è–¥–∫–∞ –Ω–µ–º–∞—î - —î –ø—Ä–æ–±–ª–µ–º–∞ –∑ Apps Script.`
                    );
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }

            } catch (error) {
                console.error('Error:', error);
                showResult('writeResult', 'error', 
                    `‚ùå –ü–û–ú–ò–õ–ö–ê:\n\n` +
                    `${error.message}\n\n` +
                    `–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:\n` +
                    `1. –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –∞–¥—Ä–µ—Å–∞ —Å–∫—Ä–∏–ø—Ç–∞\n` +
                    `2. –ß–∏ —î –¥–æ–∑–≤—ñ–ª "–£—Å—ñ" –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è\n` +
                    `3. –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∫–æ–¥ –≤ Apps Script`
                );
            }
        }

        async function checkCORS() {
            if (!GOOGLE_SCRIPT_URL) {
                showResult('corsResult', 'error', '‚ùå –°–ø–æ—á–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂—ñ—Ç—å –∞–¥—Ä–µ—Å—É!');
                return;
            }

            showResult('corsResult', 'info', '‚è≥ –ü–µ—Ä–µ–≤—ñ—Ä—è—é CORS...');

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'OPTIONS'
                });

                const corsHeaders = {
                    'access-control-allow-origin': response.headers.get('access-control-allow-origin'),
                    'access-control-allow-methods': response.headers.get('access-control-allow-methods'),
                    'access-control-allow-headers': response.headers.get('access-control-allow-headers')
                };

                console.log('CORS headers:', corsHeaders);

                showResult('corsResult', 'success', 
                    `‚úÖ CORS Headers:\n\n` +
                    JSON.stringify(corsHeaders, null, 2) + '\n\n' +
                    `–Ø–∫—â–æ –≤—Å—ñ –∑–Ω–∞—á–µ–Ω–Ω—è null - CORS –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π,\n` +
                    `–∞–ª–µ –¥–ª—è Google Apps Script —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.`
                );

            } catch (error) {
                showResult('corsResult', 'info', 
                    `‚ÑπÔ∏è CORS –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–µ –ø—Ä–æ–π—à–ª–∞, –∞–ª–µ —Ü–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.\n\n` +
                    `Google Apps Script –º–∞—î –≤–ª–∞—Å–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º CORS.\n` +
                    `–ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è\n` +
                    `–≤–∏–±—Ä–∞–Ω–æ "–£—Å—ñ" —É –ø–æ–ª—ñ "–•—Ç–æ –º–∞—î –¥–æ—Å—Ç—É–ø".`
                );
            }
        }

        function showResult(elementId, type, message) {
            const element = document.getElementById(elementId);
            element.className = 'result ' + type;
            element.textContent = message;
        }
    </script>
</body>
</html>
